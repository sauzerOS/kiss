#!/bin/sh
# Usage: kiss-owns <pattern>
# Example: kiss-owns /usr/bin/killall
# Output: psmisc /usr/bin/killall

KISS_DB_ROOT="${KISS_ROOT:+$KISS_ROOT}/var/db/kiss/installed"

if [ -z "$1" ]; then
    printf 'usage: %s <pattern>\n' "$0" >&2
    exit 1
fi

pattern="$1"

# Search all manifests for the pattern
grep -F -- "$pattern" "$KISS_DB_ROOT"/*/manifest | while IFS=: read -r manifest_path match_line; do
    pkgname=$(basename "$(dirname "$manifest_path")")
    printf '%s %s\n' "$pkgname" "$match_line"
done
